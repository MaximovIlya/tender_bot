# Устранение неполадок системы контроля доступа

## Проблема: Ошибка при нажатии на кнопку "Завершить настройку"

### Возможные причины и решения:

#### 1. База данных не обновлена
**Симптомы:** Ошибка "table tender_access doesn't exist"
**Решение:** 
```bash
python update_database.py
```

#### 2. Проблемы с редактированием сообщений Telegram
**Симптомы:** Ошибка при `edit_text()`
**Решение:** Код уже обновлен с обработкой ошибок - если не удается отредактировать сообщение, отправляется новое.

#### 3. Проблемы с правами доступа
**Симптомы:** "У вас нет прав для управления доступом"
**Решение:** Убедитесь, что пользователь имеет роль "organizer"

#### 4. Проблемы с callback data
**Симптомы:** Ошибка при парсинге callback data
**Решение:** Код обновлен с дополнительной отладкой

### Отладочная информация

Для диагностики проблем запустите:
```bash
python test_access_control.py
```

Этот скрипт проверит:
- Существование таблицы TenderAccess
- Количество пользователей и тендеров
- Структуру данных

### Логи отладки

В консоли будут выводиться сообщения вида:
```
DEBUG: Завершение настройки доступа для тендера 1, пользователь 123456
DEBUG: Найдено 3 доступов для тендера 1
```

### Частые ошибки и их решения:

1. **"Тендер не найден"** - убедитесь, что тендер существует и принадлежит организатору
2. **"Нет зарегистрированных поставщиков"** - зарегистрируйте поставщиков через интерфейс
3. **"Ошибка при редактировании сообщения"** - это нормально, система автоматически отправит новое сообщение

### Проверка работоспособности:

1. Создайте тестовый тендер
2. Зарегистрируйте тестового поставщика
3. Используйте "Управление доступом" для предоставления доступа
4. Проверьте, что поставщик видит только доступные тендеры
